<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Home | Font Finder Pro</title>
    <!-- SEO & Meta -->
    <meta name="description" content="Free Bangla Fonts Download with Advanced Preview">
    <meta property="og:image" content="https://raw.githubusercontent.com/Nafich-Shikdar/WILD-STONE/main/preview.jpg">

    <!-- Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
     <link href="style.css" rel="stylesheet">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>
  <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- CONFIGURATION ---
        const DEFAULT_OWNER = "Nafich-Shikdar"; 
        const DEFAULT_REPO = "WILD-STONE";     
        const AD_DIRECT_LINK = "";
        const SOCIAL_LINKS = { 
            telegram_main: "", 
            telegram_premium: "" 
        };
        const ITEMS_PER_PAGE = 12;
        const CACHE_DURATION = 60 * 60 * 1000; // 1 Hour Cache

        // --- CDN HELPER FUNCTION ---
        const getCDNUrl = (file) => {
            if (!file) return '';
            const path = file.path || file.name;
            return `https://cdn.jsdelivr.net/gh/${DEFAULT_OWNER}/${DEFAULT_REPO}@main/${encodeURI(path)}`;
        };

        // --- CUSTOM HOOKS ---
        
        // Lazy Load Hook
        const useIntersectionObserver = (ref, options) => {
            const [isIntersecting, setIntersecting] = useState(false);
            useEffect(() => {
                if (!ref.current) return;
                const observer = new IntersectionObserver(([entry]) => {
                    if (entry.isIntersecting) {
                        setIntersecting(true);
                        observer.disconnect(); 
                    }
                }, options);
                observer.observe(ref.current);
                return () => observer.disconnect();
            }, [ref, options]);
            return isIntersecting;
        };

        // Data for features
        const LIGATURE_WORDS = [
            "‡¶∞‡¶ï‡ßç‡¶§", "‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï", "‡¶¨‡ßç‡¶∞‡¶æ‡¶π‡ßç‡¶Æ‡¶£", "‡¶∏‡ßÇ‡¶ï‡ßç‡¶∑‡ßç‡¶Æ", 
            "‡¶â‡¶∑‡ßç‡¶£", "‡¶∏‡¶û‡ßç‡¶ö‡ßü", "‡¶ó‡¶û‡ßç‡¶ú", "‡¶π‡¶†‡¶æ‡¶§‡ßç", "‡¶∞‡¶æ‡¶∑‡ßç‡¶ü‡ßç‡¶∞", "‡¶ü‡ßç‡¶∞‡¶æ‡¶ï", 
            "‡¶¨‡¶®‡ßç‡¶ü‡¶®", "‡¶ï‡¶£‡ßç‡¶†", "‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ", "‡¶∂‡ßç‡¶∞‡¶æ‡¶¨‡¶£", "‡¶¨‡¶ú‡ßç‡¶∞", "‡¶Ü‡¶§‡ßç‡¶Æ‡¶æ", 
            "‡¶™‡¶¶‡ßç‡¶Æ", "‡¶∂‡¶§‡ßç‡¶∞‡ßÅ", "‡¶§‡¶§‡ßç‡¶§‡ßç‡¶¨", "‡¶â‡¶§‡ßç‡¶•‡¶æ‡¶®", "‡¶Æ‡¶∏‡ßç‡¶§‡¶ø‡¶∑‡ßç‡¶ï", "‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞",
            "‡¶Ü‡¶ï‡¶æ‡¶ô‡ßç‡¶ï‡ßç‡¶∑‡¶æ", "‡¶â‡¶ú‡ßç‡¶ú‡ßç‡¶¨‡¶≤", "‡¶≤‡¶ú‡ßç‡¶ú‡¶æ", "‡¶Ö‡¶û‡ßç‡¶ú‡¶≤‡¶ø", "‡¶ö‡¶ø‡¶π‡ßç‡¶®", "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßç‡¶£"
        ];
        
        const BANGLA_CHARS = [
            "‡¶Ö", "‡¶Ü", "‡¶á", "‡¶à", "‡¶â", "‡¶ä", "‡¶ã", "‡¶è", "‡¶ê", "‡¶ì", "‡¶î", 
            "‡¶ï", "‡¶ñ", "‡¶ó", "‡¶ò", "‡¶ô", "‡¶ö", "‡¶õ", "‡¶ú", "‡¶ù", "‡¶û", 
            "‡¶ü", "‡¶†", "‡¶°", "‡¶¢", "‡¶£", "‡¶§", "‡¶•", "‡¶¶", "‡¶ß", "‡¶®", 
            "‡¶™", "‡¶´", "‡¶¨", "‡¶≠", "‡¶Æ", "‡¶Ø", "‡¶∞", "‡¶≤", "‡¶∂", "‡¶∑", "‡¶∏", "‡¶π", 
            "‡ßú", "‡ßù", "‡ßü", "‡ßé", "‡¶Ç", "‡¶É", "‡¶Å"
        ];
        
        const TYPING_TEST_TEXTS = [
            "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ, ‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡ßü ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø‡•§ ‡¶ö‡¶ø‡¶∞‡¶¶‡¶ø‡¶® ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∂, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶æ‡¶∏, ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßá ‡¶¨‡¶æ‡¶ú‡¶æ‡ßü ‡¶¨‡¶æ‡¶Å‡¶∂‡¶ø‡•§",
            "‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶®‡¶ó‡¶£‡ßá‡¶∞ ‡¶ó‡ßå‡¶∞‡ßã‡¶ú‡ßç‡¶ú‡ßç‡¶¨‡¶≤ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡ßá‡¶∞ ‡¶è‡¶ï ‡¶∏‡ßç‡¶Æ‡¶∞‡¶£‡ßÄ‡ßü ‡¶¶‡¶ø‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶∂‡¶π‡ßÄ‡¶¶ ‡¶¶‡¶ø‡¶¨‡¶∏ ‡¶ì ‡¶Ü‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶ú‡¶æ‡¶§‡¶ø‡¶ï ‡¶Æ‡¶æ‡¶§‡ßÉ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá‡¶ì ‡¶∏‡ßÅ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§‡•§",
            "‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡ßá‡¶∞ ‡¶Æ‡¶® ‡¶¨‡ßú‡¶á ‡¶Ö‡¶¶‡ßç‡¶≠‡ßÅ‡¶§‡•§ ‡¶∏‡ßá ‡¶Ø‡¶æ ‡¶™‡¶æ‡ßü ‡¶§‡¶æ ‡¶ö‡¶æ‡ßü ‡¶®‡¶æ, ‡¶Ü‡¶∞ ‡¶Ø‡¶æ ‡¶™‡¶æ‡ßü ‡¶®‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶™‡ßá‡¶õ‡¶®‡ßá‡¶á ‡¶Ü‡¶ú‡ßÄ‡¶¨‡¶® ‡¶õ‡ßÅ‡¶ü‡ßá ‡¶¨‡ßá‡ßú‡¶æ‡ßü‡•§ ‡¶è‡¶ü‡¶æ‡¶á ‡¶Æ‡¶æ‡¶®‡¶¨ ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶ö‡¶ø‡¶∞‡¶®‡ßç‡¶§‡¶® ‡¶∏‡¶§‡ßç‡¶Ø‡•§",
            "‡¶∏‡¶§‡¶§‡¶æ‡¶á ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡ßé‡¶ï‡ßÉ‡¶∑‡ßç‡¶ü ‡¶™‡¶®‡ßç‡¶•‡¶æ‡•§ ‡¶Ø‡ßá ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‡¶∏‡ßé ‡¶™‡¶•‡ßá ‡¶ö‡¶≤‡ßá, ‡¶∏‡¶æ‡¶Æ‡ßü‡¶ø‡¶ï ‡¶ï‡¶∑‡ßç‡¶ü ‡¶π‡¶≤‡ßá‡¶ì ‡¶∂‡ßá‡¶∑ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¨‡¶ø‡¶ú‡ßü ‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡•§ ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶Æ‡ßü‡¶ø‡¶ï ‡¶≤‡¶æ‡¶≠ ‡¶π‡¶≤‡ßá‡¶ì ‡¶§‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶π‡ßü ‡¶®‡¶æ‡•§"
        ];

        const firebaseConfig = {
            apiKey: "AIzaSyCEAMA93We6yWaUGmfrK_FFHDpC42YdbV8",
            authDomain: "wild-stone-face.firebaseapp.com",
            databaseURL: "https://wild-stone-face-default-rtdb.firebaseio.com",
            projectId: "wild-stone-face",
            storageBucket: "wild-stone-face.firebasestorage.app",
            messagingSenderId: "863449289766",
            appId: "1:863449289766:web:82c1e1c38c5b3cc151c2e7"
        };

        let db;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch (e) { console.error("Firebase Error:", e); }

        // --- ICONS & UTILS ---
        const Icon = ({ name, className }) => {
            const [svgHtml, setSvgHtml] = useState(null);
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const key = Object.keys(window.lucide.icons).find(k => k.toLowerCase() === pascalName.toLowerCase());
                    if (key) {
                        try {
                            const svgElement = window.lucide.createElement(window.lucide.icons[key]);
                            if (className) svgElement.setAttribute('class', `lucide lucide-${name} ${className}`);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) {}
                    }
                }
            }, [name, className]);
            if (!svgHtml) return <span className={`inline-block ${className || 'w-4 h-4'}`}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="inline-flex items-center justify-center" />;
        };

        // --- TOAST NOTIFICATION COMPONENT ---
        const ToastContainer = ({ toasts }) => (
            <div className="fixed bottom-6 right-6 z-[200] flex flex-col gap-2 pointer-events-none">
                {toasts.map(toast => (
                    <div key={toast.id} className={`pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-lg shadow-xl text-white text-sm font-bold min-w-[250px] animate-fade-in ${toast.type === 'error' ? 'bg-red-600' : 'bg-cyan-600'}`}>
                        <Icon name={toast.type === 'error' ? 'alert-circle' : 'check-circle'} className="w-5 h-5" />
                        {toast.message}
                    </div>
                ))}
            </div>
        );

        // --- NAVIGATION ---
        const Navigation = ({ onOpenSubmit, onOpenTypingTest, showFav, setShowFav }) => (
            <div className="glass-effect sticky top-0 z-50">
                <div className="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-3">
                    <div className="flex items-center justify-between w-full md:w-auto">
                        <a href="index.html" className="flex items-center gap-2">
                            <div className="bg-gradient-to-br from-cyan-500 to-blue-600 p-2 rounded-lg"><Icon name="type" className="text-white w-5 h-5" /></div>
                            <span className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">Font Finder</span>
                        </a>
                        <div className="flex md:hidden gap-2">
                            <button onClick={() => setShowFav(!showFav)} className={`p-2 rounded-lg ${showFav ? 'bg-pink-600 text-white' : 'bg-slate-800 text-slate-300'}`}><Icon name="heart" className="w-5 h-5" /></button>
                            <button onClick={onOpenSubmit} className="p-2 rounded-lg bg-slate-800 text-cyan-400"><Icon name="upload" className="w-5 h-5" /></button>
                        </div>
                    </div>
                    <div className="flex flex-wrap justify-center gap-2 items-center text-xs md:text-sm font-medium">
                        <a href="index.html" className="px-3 py-1.5 rounded-md bg-slate-800 text-white border border-slate-700">Home</a>
                        <button onClick={onOpenTypingTest} className="px-3 py-1.5 rounded-md text-emerald-400 hover:text-white hover:bg-slate-800 transition flex items-center gap-1 border border-emerald-900/30"><Icon name="keyboard" className="w-3 h-3" /> Typing Test</button>
                        <a href="converter.html" className="px-3 py-1.5 rounded-md text-slate-400 hover:text-white hover:bg-slate-800 transition flex items-center gap-1"><Icon name="refresh-cw" className="w-3 h-3" /> Converter</a>
                        <a href="request.html" className="px-3 py-1.5 rounded-md text-slate-400 hover:text-white hover:bg-slate-800 transition flex items-center gap-1"><Icon name="message-square-plus" className="w-3 h-3" /> Request</a>
                        <button onClick={() => setShowFav(!showFav)} className={`hidden md:flex items-center gap-1 px-3 py-1.5 rounded-md font-bold ml-1 transition ${showFav ? 'bg-pink-600 text-white' : 'bg-slate-700 text-slate-300 hover:text-white'}`}>
                            <Icon name="heart" className="w-3 h-3" /> Favs
                        </button>
                        <button onClick={onOpenSubmit} className="hidden md:flex items-center gap-1 bg-cyan-600 hover:bg-cyan-500 text-white px-3 py-1.5 rounded-md font-bold ml-1 transition">
                            <Icon name="upload" className="w-3 h-3" /> Submit
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- COMPONENTS ---
        const MaintenanceScreen = () => (<div className="min-h-screen flex flex-col items-center justify-center bg-slate-900 text-center animate-fade-in"><div className="w-24 h-24 bg-yellow-500/10 rounded-full flex items-center justify-center mb-6 animate-pulse"><Icon name="wrench" className="w-12 h-12 text-yellow-500" /></div><h1 className="text-3xl font-bold text-white mb-2">‡¶∏‡¶æ‡¶á‡¶ü ‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡¶æ‡¶¨‡ßá‡¶ï‡ßç‡¶∑‡¶£ ‡¶ö‡¶≤‡¶õ‡ßá</h1><p className="text-slate-400">‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div>);

        const SmartNotice = ({ config }) => {
            if (!config || !config.isActive) return null;
            return (
                <div className="relative z-40 animate-fade-in">
                    {config.showImage && config.imageUrl && (<div className="bg-slate-900 border-b border-slate-800"><a href={config.imageLink || '#'} className={`block max-w-7xl mx-auto ${config.imageLink ? 'cursor-pointer' : ''}`}><img src={config.imageUrl} className="w-full h-auto max-h-[250px] object-cover md:object-center" alt="Notice" /></a></div>)}
                    {(config.showCopy || config.showCTA) && (<div className="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-700/50 shadow-lg"><div className="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-4 text-center md:text-left">{config.showCopy && <div className="flex items-center gap-3 justify-center md:justify-start flex-1"><span className="bg-indigo-500/20 p-2 rounded-full animate-pulse"><Icon name="bell" className="w-4 h-4 text-indigo-400" /></span><p className="text-slate-200 text-sm md:text-base font-medium">{config.text}</p></div>}{config.showCTA && <a href={config.btnLink} target="_blank" className="bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-2 rounded-full font-bold text-xs md:text-sm transition shadow-lg flex items-center gap-2 whitespace-nowrap">{config.btnText || "Click Here"} <Icon name="arrow-right" className="w-4 h-4" /></a>}</div></div>)}
                </div>
            );
        };

        const NewsTicker = ({ fonts }) => {
            if (!fonts || fonts.length === 0) return null;
            return <div className="bg-slate-800/80 border-b border-slate-700 h-10 flex items-center overflow-hidden relative z-30"><div className="max-w-7xl mx-auto px-4 w-full flex items-center"><div className="flex items-center gap-2 text-cyan-400 font-bold text-xs whitespace-nowrap z-20 bg-slate-800/90 h-10 pr-4 shadow border-r border-slate-700/50"><Icon name="bell" className="w-3 h-3 animate-pulse" /> UPDATE:</div><div className="flex-1 overflow-hidden relative h-full flex items-center"><div className="animate-marquee pl-4">{fonts.map((f, i) => <span key={i} className="text-slate-300 text-xs inline-flex items-center gap-2 mr-8"><span className="w-1.5 h-1.5 rounded-full bg-cyan-500"></span> {f.name}</span>)}</div></div></div></div>;
        };

        const PromoBanner = () => (
            <div className="max-w-7xl mx-auto px-4 mt-6"><div className="bg-gradient-to-br from-indigo-900 via-slate-900 to-slate-900 border border-indigo-500/20 rounded-2xl p-6 relative overflow-hidden group"><div className="absolute top-0 right-0 w-48 h-48 bg-indigo-500/10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div><div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10"><div className="text-center md:text-left"><h2 className="text-xl md:text-2xl font-bold text-white mb-2">‡¶ï‡¶Æ‡¶ø‡¶â‡¶®‡¶ø‡¶ü‡¶ø‡¶§‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßã‡¶® üöÄ</h2><p className="text-indigo-200 text-sm md:text-base">‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div><div className="flex flex-wrap justify-center gap-3 w-full md:w-auto"><a href={SOCIAL_LINKS.telegram_main} target="_blank" className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-[#229ED9] hover:bg-[#1e8bc0] text-white px-4 py-2.5 rounded-lg font-medium text-sm transition shadow-lg"><Icon name="send" className="w-4 h-4" /> Fonts Collection</a><a href={SOCIAL_LINKS.telegram_premium} target="_blank" className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-[#229ED9] hover:bg-[#1e8bc0] text-white px-4 py-2.5 rounded-lg font-medium text-sm transition shadow-lg"><Icon name="star" className="w-4 h-4" /> Premium Fonts</a></div></div></div></div>
        );

        const AdsterraIframe = ({ w, h, o, s }) => {
            const r = useRef(null);
            const refObserved = useIntersectionObserver(r, { threshold: 0.1 }); 
            useEffect(() => { 
                if (r.current && refObserved) { 
                    r.current.innerHTML = ''; 
                    const i = document.createElement('iframe'); 
                    i.width=w; i.height=h; i.style.border='none'; i.scrolling='no'; 
                    r.current.appendChild(i); 
                    const d = i.contentWindow.document; 
                    d.open(); 
                    d.write(`<!DOCTYPE html><html><body style="margin:0;display:flex;justify-content:center;"><script>atOptions=${JSON.stringify(o)};<\/script><script src="${s}"><\/script></body></html>`); 
                    d.close(); 
                } 
            }, [refObserved]);
            return <div ref={r} style={{width:w,height:h,margin:'0 auto'}} className="bg-slate-800/50 rounded flex items-center justify-center"></div>;
        };

        // --- MODALS ---
        
        // Typing Test Modal
        const TypingTestModal = ({ fonts, onClose }) => {
            const [selectedFont, setSelectedFont] = useState(fonts[0] || null);
            const [text, setText] = useState("");
            const [userInput, setUserInput] = useState("");
            const [started, setStarted] = useState(false);
            const [finished, setFinished] = useState(false);
            const [startTime, setStartTime] = useState(null);
            const [wpm, setWpm] = useState(0);
            const [accuracy, setAccuracy] = useState(100);

            useEffect(() => {
                setText(TYPING_TEST_TEXTS[Math.floor(Math.random() * TYPING_TEST_TEXTS.length)]);
            }, []);

            const handleInput = (e) => {
                const val = e.target.value;
                if(!started) {
                    setStarted(true);
                    setStartTime(Date.now());
                }
                setUserInput(val);

                if(val === text) {
                    const time = (Date.now() - startTime) / 60000; 
                    const words = text.split(" ").length;
                    setWpm(Math.round(words / time));
                    setAccuracy(100);
                    setFinished(true);
                }
            };

            const reset = () => {
                setUserInput("");
                setStarted(false);
                setFinished(false);
                setWpm(0);
                setText(TYPING_TEST_TEXTS[Math.floor(Math.random() * TYPING_TEST_TEXTS.length)]);
            };

            return (
                <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-2xl rounded-xl p-6 shadow-2xl relative border border-slate-700">
                        <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                            <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="keyboard" className="w-5 h-5 text-emerald-400"/> ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶ü‡ßá‡¶∏‡ßç‡¶ü</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                        </div>

                        {!finished ? (
                            <div className="space-y-4">
                                <div className="flex gap-4 mb-4">
                                    <select onChange={(e) => setSelectedFont(fonts.find(f => f.name === e.target.value))} className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm outline-none flex-1">
                                        {fonts.map(f => <option key={f.name} value={f.name}>{f.name}</option>)}
                                    </select>
                                    <button onClick={reset} className="p-2 bg-slate-700 rounded text-slate-300 hover:text-white"><Icon name="rotate-ccw" className="w-4 h-4" /></button>
                                </div>
                                
                                {selectedFont && <style>{`@font-face { font-family: 'tt_${selectedFont.sha}'; src: url('${getCDNUrl(selectedFont)}'); font-display: swap; }`}</style>}
                                
                                <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700 relative">
                                    <p className="text-xl text-slate-400 mb-4 select-none leading-relaxed" style={{fontFamily: selectedFont ? `tt_${selectedFont.sha}` : 'sans-serif'}}>
                                        {text}
                                    </p>
                                    <textarea 
                                        value={userInput}
                                        onChange={handleInput}
                                        placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®..."
                                        className="w-full bg-slate-800 border border-slate-600 rounded p-4 text-white text-xl outline-none focus:border-emerald-500 transition leading-relaxed"
                                        style={{fontFamily: selectedFont ? `tt_${selectedFont.sha}` : 'sans-serif'}}
                                        rows="3"
                                    ></textarea>
                                </div>
                                <div className="text-center text-sm text-slate-500">
                                    {started ? "‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶≤‡¶õ‡ßá..." : "‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá"}
                                </div>
                            </div>
                        ) : (
                            <div className="text-center py-10">
                                <div className="inline-block p-4 rounded-full bg-emerald-500/20 text-emerald-400 mb-4"><Icon name="trophy" className="w-12 h-12" /></div>
                                <h2 className="text-3xl font-bold text-white mb-2">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h2>
                                <p className="text-slate-400 mb-6">‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§</p>
                                <div className="flex justify-center gap-8 mb-8">
                                    <div><p className="text-4xl font-bold text-emerald-400">{wpm}</p><p className="text-xs uppercase tracking-wider text-slate-500">WPM</p></div>
                                    <div><p className="text-4xl font-bold text-blue-400">100%</p><p className="text-xs uppercase tracking-wider text-slate-500">Accuracy</p></div>
                                </div>
                                <button onClick={reset} className="bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg font-bold">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const DownloadModal = ({ file, onClose, showToast }) => {
            const [t, sT] = useState(5); const [can, sCan] = useState(false); const [zip, sZip] = useState(false);
            useEffect(() => { const i = setInterval(() => sT(p => { if (p <= 1) { clearInterval(i); sCan(true); return 0; } return p - 1; }), 1000); return () => clearInterval(i); }, []);
            const handleDL = async () => {
                if(AD_DIRECT_LINK) window.open(AD_DIRECT_LINK, '_blank');
                sZip(true);
                showToast("Download started...", "success");
                try {
                    if (db) { const b = db.batch(); b.set(db.collection("fonts").doc(file.name), { count: firebase.firestore.FieldValue.increment(1) }, { merge: true }); b.set(db.collection("stats").doc("global"), { totalDownloads: firebase.firestore.FieldValue.increment(1) }, { merge: true }); b.commit(); }
                    const r = await fetch(getCDNUrl(file));
                    const b = await r.blob(); const z = new JSZip(); z.file(file.name, b); z.file("About.txt", "Downloaded from Font Finder."); z.file("Social_Links.txt", `Join our Telegram Channels:\n\nFonts Collection Team: ${SOCIAL_LINKS.telegram_main}\nPremium Bangla Fonts: ${SOCIAL_LINKS.telegram_premium}`);
                    const c = await z.generateAsync({ type: "blob" }); saveAs(c, `${file.name}.zip`);
                    setTimeout(onClose, 1000);
                } catch (e) { console.error(e); sZip(false); showToast("Download failed!", "error"); }
            };
            return (
                <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-md rounded-xl p-6 shadow-2xl relative text-center">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400"><Icon name="x" className="w-5 h-5" /></button>
                        <h3 className="text-xl font-bold text-white mb-2">Downloading {file.name}</h3>
                        <div className="my-4 flex justify-center"><AdsterraIframe w={300} h={250} o={{'key':'e88f142bc03f2dfd9f32a9f78cf56137','format':'iframe','height':250,'width':300,'params':{}}} s="https://www.highperformanceformat.com/e88f142bc03f2dfd9f32a9f78cf56137/invoke.js"/></div>
                        {can ? <button onClick={handleDL} disabled={zip} className="w-full bg-emerald-600 text-white py-3 rounded font-bold">{zip ? "Zipping..." : "Download (Zip)"}</button> : <button disabled className="w-full bg-slate-700 text-slate-400 py-3 rounded">Wait {t}s</button>}
                    </div>
                </div>
            );
        };

        const GlyphModal = ({ font, onClose, showToast }) => {
            if (!font) return null;
            const handleCopy = (char) => {
                navigator.clipboard.writeText(char);
                if(showToast) showToast(`Copied: ${char}`, 'success');
                else alert(`Copied: ${char}`);
            };
            return (
                <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-2xl rounded-xl p-6 shadow-2xl relative border border-slate-700 flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center mb-4 border-b border-slate-700 pb-3">
                            <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="grid" className="w-5 h-5 text-cyan-400"/> ‡¶¨‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶≤‡¶æ (Click to Copy)</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                        </div>
                        <style>{`@font-face { font-family: 'g_${font.sha}'; src: url('${getCDNUrl(font)}'); font-display: swap; }`}</style>
                        <div className="grid grid-cols-6 sm:grid-cols-8 gap-2 overflow-y-auto p-2 bg-slate-900/50 rounded-lg custom-scrollbar">
                            {BANGLA_CHARS.map((char, i) => (
                                <div key={i} onClick={() => handleCopy(char)} className="aspect-square bg-slate-800 border border-slate-700 rounded flex items-center justify-center text-3xl hover:bg-slate-700 hover:scale-105 transition hover:border-cyan-500/50 cursor-pointer active:scale-95" style={{fontFamily: `g_${font.sha}`}} title="Click to copy">
                                    {char}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const LigatureModal = ({ font, onClose }) => {
            const [generating, setGenerating] = useState(false);
            if (!font) return null;

            const handleDownloadImage = async () => {
                setGenerating(true);
                try {
                    const shuffled = [...LIGATURE_WORDS].sort(() => 0.5 - Math.random());
                    const selectedWords = shuffled.slice(0, 4);
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const size = 1080; 
                    canvas.width = size;
                    canvas.height = size;

                    const grd = ctx.createLinearGradient(0, 0, 0, size);
                    grd.addColorStop(0, "#0f172a"); 
                    grd.addColorStop(1, "#1e293b"); 
                    ctx.fillStyle = grd;
                    ctx.fillRect(0, 0, size, size);

                    ctx.fillStyle = "#06b6d4"; 
                    ctx.fillRect(0, 0, size, 20);

                    ctx.textAlign = "center";
                    ctx.fillStyle = "#ffffff";
                    ctx.font = "bold 80px 'Segoe UI', sans-serif";
                    ctx.fillText(font.name, size / 2, 180);
                    
                    ctx.fillStyle = "#94a3b8"; 
                    ctx.font = "40px 'Segoe UI', sans-serif";
                    ctx.fillText("fontsfinder.netlify.app", size / 2, 250);

                    ctx.strokeStyle = "#334155";
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(100, 290);
                    ctx.lineTo(size - 100, 290);
                    ctx.stroke();

                    const fontString = `100px 'l_${font.sha}'`;
                    await document.fonts.load(fontString);
                    ctx.font = fontString;

                    const startY = 320;
                    const gridHeight = 550;
                    const cellWidth = size / 2;
                    const cellHeight = gridHeight / 2;

                    selectedWords.forEach((word, i) => {
                        const col = i % 2;
                        const row = Math.floor(i / 2);
                        const x = (col * cellWidth) + (cellWidth / 2);
                        const y = startY + (row * cellHeight) + (cellHeight / 2) + 20;
                        const cardX = (col * cellWidth) + 30;
                        const cardY = startY + (row * cellHeight) + 15;
                        const cardW = cellWidth - 60;
                        const cardH = cellHeight - 30;

                        ctx.fillStyle = "rgba(30, 41, 59, 0.6)"; 
                        ctx.strokeStyle = "rgba(148, 163, 184, 0.2)";
                        ctx.lineWidth = 2;
                        
                        // Fix for older browsers not supporting roundRect
                        ctx.beginPath();
                        if (ctx.roundRect) {
                            ctx.roundRect(cardX, cardY, cardW, cardH, 20);
                        } else {
                            ctx.rect(cardX, cardY, cardW, cardH);
                        }
                        ctx.fill();
                        ctx.stroke();

                        ctx.fillStyle = "#06b6d4";
                        ctx.fillRect(cardX + 40, cardY + cardH - 5, cardW - 80, 5);

                        ctx.fillStyle = "#e2e8f0"; 
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.font = fontString;
                        ctx.fillText(word, x, y - 10);
                        
                        ctx.fillStyle = "#64748b";
                        ctx.font = "24px 'Segoe UI', sans-serif";
                        ctx.fillText(word, x, y + 70); 
                    });

                    const footerY = size - 100;
                    ctx.strokeStyle = "#334155";
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(200, size - 180);
                    ctx.lineTo(size - 200, size - 180);
                    ctx.stroke();

                    ctx.fillStyle = "#06b6d4"; 
                    ctx.font = "bold 50px 'Segoe UI', sans-serif";
                    ctx.fillText("Telegram/@Fonts_Collection_Team", size / 2, footerY);
                    
                    ctx.fillStyle = "#94a3b8";
                    ctx.font = "30px 'Segoe UI', sans-serif";
                    ctx.fillText("fontsfinder.netlify.app", size / 2, footerY + 50);

                    canvas.toBlob((blob) => {
                        saveAs(blob, `${font.name}_Social_Post.png`);
                        setGenerating(false);
                    });

                } catch (e) {
                    console.error("Image Gen Error:", e);
                    setGenerating(false);
                    alert("Failed to generate image. Please try again.");
                }
            };

            return (
                <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-3xl rounded-xl p-6 shadow-2xl relative border border-slate-700 flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center mb-4 border-b border-slate-700 pb-3">
                            <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="link" className="w-5 h-5 text-emerald-400"/> ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶¨‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ (Ligature Test)</h3>
                            <div className="flex gap-2">
                                <button onClick={handleDownloadImage} disabled={generating} className="flex items-center gap-2 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white rounded text-sm font-bold transition disabled:opacity-50">
                                    {generating ? <><span className="animate-spin">‚åõ</span> Processing...</> : <><Icon name="image" className="w-4 h-4" /> Download Post (1:1)</>}
                                </button>
                                <button onClick={onClose} className="text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                            </div>
                        </div>
                        <style>{`@font-face { font-family: 'l_${font.sha}'; src: url('${getCDNUrl(font)}'); font-display: swap; }`}</style>
                        <div className="overflow-y-auto p-4 bg-slate-900/50 rounded-lg custom-scrollbar">
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                {LIGATURE_WORDS.map((word, i) => (
                                    <div key={i} className="p-4 bg-slate-800 border border-slate-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-emerald-500/50 transition">
                                        <span className="text-3xl text-white" style={{fontFamily: `l_${font.sha}`}}>{word}</span>
                                        <span className="text-xs text-slate-500">{word}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const CompareModal = ({ fonts, text, onClose }) => {
            return (
                <div className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-md flex items-center justify-center p-4">
                    <div className="bg-slate-900 w-full max-w-4xl rounded-xl p-6 shadow-2xl relative border border-slate-700 flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                            <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="columns" className="w-5 h-5 text-purple-400"/> ‡¶´‡¶®‡ßç‡¶ü ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ (Compare)</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                        </div>
                        <div className="overflow-y-auto space-y-4 custom-scrollbar pr-2">
                            {fonts.map(font => (
                                <div key={font.name} className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between mb-2">
                                        <h4 className="text-cyan-400 text-sm font-bold">{font.name}</h4>
                                        <span className="text-[10px] text-slate-500">{(font.size/1024).toFixed(1)} KB</span>
                                    </div>
                                    <style>{`@font-face { font-family: 'c_${font.sha}'; src: url('${getCDNUrl(font)}'); font-display: swap; }`}</style>
                                    <p className="text-2xl text-white break-words leading-relaxed" style={{fontFamily: `c_${font.sha}`}}>{text || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ"}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const SubmitFontModal = ({ isOpen, onClose, existingFonts, showToast }) => {
            const [file, setFile] = useState(null); const [up, setUp] = useState(false);
            if (!isOpen) return null;
            const sanitize = n => n.replace(/[^\u0980-\u09FFa-zA-Z0-9\s.\-_()]/g, '_').trim();
            const submit = async (e) => {
                e.preventDefault(); if (!file) return;
                const ext = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                if (!['.ttf', '.otf'].includes(ext)) { showToast("Only .ttf/.otf allowed", "error"); return; }
                const name = sanitize(file.name);
                if (existingFonts.some(f => f.name.toLowerCase() === name.toLowerCase())) { showToast("Font already exists!", "error"); return; }
                setUp(true);
                try {
                    const r = new FileReader(); r.readAsDataURL(file);
                    r.onload = async () => {
                        await db.collection('pending_uploads').doc(name).set({ name, content: r.result.split(',')[1], size: file.size, timestamp: firebase.firestore.FieldValue.serverTimestamp(), uploader: 'Visitor' });
                        showToast("Submitted for approval!", "success"); setUp(false); setTimeout(onClose, 1000);
                    };
                } catch { showToast("Error uploading.", "error"); setUp(false); }
            };
            return (
                <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-md rounded-xl p-6 shadow-2xl relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400"><Icon name="x" className="w-5 h-5" /></button>
                        <h3 className="text-xl font-bold text-white mb-4">Submit Font</h3>
                        <form onSubmit={submit} className="space-y-4">
                            <div className="border-2 border-dashed border-slate-600 rounded-lg p-6 text-center bg-slate-900/50">
                                <input type="file" accept=".ttf,.otf" onChange={e => setFile(e.target.files[0])} className="hidden" id="v-upload" />
                                <label htmlFor="v-upload" className="cursor-pointer flex flex-col items-center"><Icon name="file-plus" className="w-10 h-10 text-slate-400 mb-2"/><span className="text-sm text-slate-300 font-medium">{file ? file.name : "Select Font"}</span><span className="text-[10px] text-slate-500 mt-1">Max 1MB</span></label>
                            </div>
                            <button disabled={up || !file} className="w-full bg-cyan-600 text-white py-2 rounded font-bold">{up ? "Uploading..." : "Submit"}</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- OPTIMIZED FONT CARD WITH LAZY LOADING ---
        const FontCard = ({ file, viewMode, previewText, previewFontSize, previewColor, previewBg, letterSpacing, textEffects, onDownloadClick, downloadCount, isFav, onToggleFav, onOpenGlyph, onOpenLigature, onToggleCompare, isCompared, isTrending, showToast }) => {
            
            const cardRef = useRef(null);
            const isVisible = useIntersectionObserver(cardRef, { rootMargin: '100px', threshold: 0.1 }); 

            const handleShare = () => {
                const url = new URL(window.location.href);
                url.searchParams.set('search', file.name);
                navigator.clipboard.writeText(url.toString());
                showToast("Direct link copied!", "success");
            };

            // Calculate Styles
            const previewStyle = {
                fontFamily:`f_${file.sha}, sans-serif`, // Fallback font added
                fontSize: previewFontSize, 
                color: previewColor, 
                letterSpacing: `${letterSpacing}px`,
                fontWeight: textEffects.bold ? 'bold' : 'normal',
                fontStyle: textEffects.italic ? 'italic' : 'normal',
                textShadow: textEffects.shadow ? '2px 2px 4px rgba(0,0,0,0.5)' : 'none',
                WebkitTextStroke: textEffects.outline ? '1px currentColor' : '0',
                color: textEffects.outline ? 'transparent' : previewColor,
            };

            // LIST VIEW LAYOUT
            if (viewMode === 'list') {
                return (
                    <div ref={cardRef} className="bg-slate-800 p-3 rounded-lg border border-slate-700 hover:border-cyan-500/30 transition flex flex-col sm:flex-row items-center justify-between gap-4 group relative min-h-[80px]">
                        <div className="w-full sm:w-1/4 flex items-center gap-3">
                            <input type="checkbox" checked={isCompared} onChange={() => onToggleCompare(file)} className="w-4 h-4 rounded border-slate-600 custom-checkbox cursor-pointer" title="Compare" />
                            <div className="flex-1">
                                <h3 className="text-cyan-400 font-mono text-sm truncate max-w-[150px] cursor-pointer flex items-center gap-2" onClick={() => onOpenGlyph(file)} title={file.name}>
                                    {file.name}
                                    {isTrending && <span className="text-[10px] bg-orange-500/20 text-orange-400 px-1.5 py-0.5 rounded border border-orange-500/30 flex items-center gap-0.5"><Icon name="flame" className="w-3 h-3"/> Hot</span>}
                                </h3>
                                <p className="text-[10px] text-slate-500">{(file.size / 1024).toFixed(1)} KB</p>
                            </div>
                            <button onClick={() => onToggleFav(file.name)} className="sm:hidden p-1.5 rounded-full text-slate-400 hover:text-pink-500 transition-colors">
                                <Icon name="heart" className={`w-4 h-4 ${isFav ? 'text-pink-500 fill-pink-500' : ''}`} />
                            </button>
                        </div>

                        <div className="w-full sm:flex-1 h-12 flex items-center justify-start overflow-hidden rounded border border-slate-700/30 px-4 transition-all relative" style={{backgroundColor: previewBg}}>
                            {isVisible ? (
                                <>
                                    <p style={previewStyle} className="whitespace-nowrap transition-all duration-300">{previewText}</p>
                                    <style>{`@font-face { font-family: 'f_${file.sha}'; src: url('${getCDNUrl(file)}'); font-display: swap; }`}</style>
                                </>
                            ) : (
                                <div className="w-3/4 h-4 rounded skeleton"></div>
                            )}
                        </div>

                        <div className="w-full sm:w-auto flex items-center justify-end gap-2">
                            <button onClick={() => onOpenLigature(file)} className="p-2 rounded bg-slate-700 hover:bg-slate-600 text-emerald-400" title="Check Ligatures (‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶¨‡¶∞‡ßç‡¶£)"><Icon name="link" className="w-4 h-4" /></button>
                            <button onClick={() => onOpenGlyph(file)} className="p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-300" title="View Glyphs"><Icon name="grid" className="w-4 h-4" /></button>
                            <button onClick={handleShare} className="p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-300" title="Copy Link"><Icon name="share-2" className="w-4 h-4" /></button>
                            <button onClick={() => onToggleFav(file.name)} className="hidden sm:block p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-400 hover:text-pink-500 transition-colors">
                                <Icon name="heart" className={`w-4 h-4 ${isFav ? 'text-pink-500 fill-pink-500' : ''}`} />
                            </button>
                            <button onClick={() => onDownloadClick(file)} className="flex-1 sm:flex-none bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded text-xs font-bold flex items-center justify-center gap-1 transition">
                                <Icon name="download" className="w-3 h-3" /> <span className="sm:hidden md:inline">DL</span>
                            </button>
                        </div>
                    </div>
                );
            }

            // GRID VIEW LAYOUT
            return (
                <div ref={cardRef} className={`bg-slate-800 p-4 rounded-xl border transition relative group flex flex-col justify-between h-full min-h-[200px] ${isCompared ? 'border-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.2)]' : 'border-slate-700 hover:border-cyan-500/30'}`}>
                    {isTrending && <div className="absolute -top-2 -right-2 bg-orange-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg z-20 flex items-center gap-1"><Icon name="flame" className="w-3 h-3 fill-white" /> Trending</div>}
                    <div className="flex justify-between items-start mb-2 pr-8 relative">
                        <div className="flex items-center gap-2 overflow-hidden">
                             <input type="checkbox" checked={isCompared} onChange={() => onToggleCompare(file)} className="w-4 h-4 rounded border-slate-600 custom-checkbox cursor-pointer shrink-0" title="Add to Compare" />
                             <h3 className="text-cyan-400 font-mono text-sm truncate cursor-pointer hover:underline" onClick={() => onOpenGlyph(file)} title={file.name}>{file.name}</h3>
                        </div>
                        <div className="absolute top-0 right-0 flex gap-1">
                             <button onClick={() => onOpenLigature(file)} className="p-1.5 rounded-full bg-slate-900/80 text-emerald-400 hover:text-emerald-300 z-10 transition-colors" title="Ligatures"><Icon name="link" className="w-3 h-3" /></button>
                             <button onClick={() => onOpenGlyph(file)} className="p-1.5 rounded-full bg-slate-900/80 text-slate-400 hover:text-white z-10 transition-colors" title="Glyphs"><Icon name="grid" className="w-3 h-3" /></button>
                             <button onClick={handleShare} className="p-1.5 rounded-full bg-slate-900/80 text-slate-400 hover:text-cyan-400 z-10 transition-colors" title="Share"><Icon name="share-2" className="w-3 h-3" /></button>
                             <button onClick={() => onToggleFav(file.name)} className="p-1.5 rounded-full bg-slate-900/80 text-slate-400 hover:text-pink-500 z-10 transition-colors">
                                <Icon name="heart" className={`w-3 h-3 ${isFav ? 'text-pink-500 fill-pink-500' : ''}`} />
                             </button>
                        </div>
                    </div>

                    <div className="transition-colors duration-300 p-2 h-24 flex items-center justify-center overflow-hidden rounded mb-3 border border-slate-700/30 cursor-pointer relative" onClick={() => onOpenGlyph(file)} style={{backgroundColor: previewBg}}>
                        {isVisible ? (
                            <>
                                <p style={previewStyle} className="text-center whitespace-nowrap transition-all duration-300">{previewText}</p>
                                <style>{`@font-face { font-family: 'f_${file.sha}'; src: url('${getCDNUrl(file)}'); font-display: swap; }`}</style>
                            </>
                        ) : (
                            <div className="w-full h-8 rounded skeleton"></div>
                        )}
                    </div>

                    <div className="flex items-center justify-between gap-2 mt-auto">
                        <div className="bg-slate-900 px-2 py-1.5 rounded-md border border-slate-700 flex items-center gap-1 text-[10px] text-slate-400 shrink-0">
                            <Icon name="download" className="w-3 h-3" /> {downloadCount || 0}
                        </div>
                        <button onClick={() => onDownloadClick(file)} className="flex-1 bg-slate-700 hover:bg-cyan-600 text-white py-1.5 rounded text-xs font-bold flex items-center justify-center gap-1 transition">
                            Download
                        </button>
                    </div>
                </div>
            );
        };

        const Home = () => {
            const [fonts, setFonts] = useState([]); const [recent, setRecent] = useState([]); const [loading, setLoading] = useState(true);
            const [search, setSearch] = useState(""); const [preview, setPreview] = useState("‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ"); const [size, setSize] = useState(32);
            const [viewMode, setViewMode] = useState('grid');
            const [previewColor, setPreviewColor] = useState('#ffffff');
            const [previewBg, setPreviewBg] = useState('transparent');
            const [letterSpacing, setLetterSpacing] = useState(0); 
            // New Effect State
            const [textEffects, setTextEffects] = useState({ bold: false, italic: false, shadow: false, outline: false });
            // New Voice State
            const [isListening, setIsListening] = useState(false);

            const [sortBy, setSortBy] = useState('date');
            const [currentPage, setCurrentPage] = useState(1);
            
            // Modals
            const [dlFile, setDlFile] = useState(null); 
            const [submitOpen, setSubmitOpen] = useState(false);
            const [glyphFont, setGlyphFont] = useState(null);
            const [ligatureFont, setLigatureFont] = useState(null); 
            const [compareList, setCompareList] = useState([]); 
            const [showCompareModal, setShowCompareModal] = useState(false);
            const [showTypingTest, setShowTypingTest] = useState(false); 
            const [toasts, setToasts] = useState([]); 

            const [config, setConfig] = useState({ isSiteActive: true, notice: {} }); const [loaded, setLoaded] = useState(false);
            const [totalDownloads, setTotalDownloads] = useState(0); const [fontStats, setFontStats] = useState({});
            const [favorites, setFavorites] = useState([]); const [showFav, setShowFav] = useState(false);

            // Toast Function
            const showToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };

            // URL Search Param Check
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const query = params.get('search');
                if(query) {
                    setSearch(query);
                    showToast(`Filtered: ${query}`, "success");
                }
            }, []);

            useEffect(() => {
                if(!db) return;
                const unsubConfig = db.collection('settings').doc('config').onSnapshot(d => { if(d.exists) { let data = d.data(); if (!data.notice) data.notice = { type: 'copy', text: data.noticeText || '', isActive: !!data.noticeText }; setConfig(data); } else setConfig({ isSiteActive: true, notice: { isActive: false } }); setLoaded(true); });
                const unsubStats = db.collection("stats").doc("global").onSnapshot(doc => { if (doc.exists) setTotalDownloads(doc.data().totalDownloads || 0); });
                const unsubFontStats = db.collection("fonts").onSnapshot(snapshot => { const stats = {}; snapshot.forEach(doc => stats[doc.id] = doc.data().count); setFontStats(stats); });
                const today = new Date().toISOString().split('T')[0];
                if (localStorage.getItem('last_visit') !== today) { db.collection('analytics').doc(today).set({ visitors: firebase.firestore.FieldValue.increment(1) }, { merge: true }); db.collection('stats').doc('global').set({ totalVisitors: firebase.firestore.FieldValue.increment(1) }, { merge: true }); localStorage.setItem('last_visit', today); }
                const savedFavs = localStorage.getItem('fav_fonts'); if(savedFavs) setFavorites(JSON.parse(savedFavs));
                return () => { unsubConfig(); unsubStats(); unsubFontStats(); }
            }, []);

            // --- FETCH FONTS FROM STATIC JSON (NO API LIMIT) ---
            useEffect(() => {
                const fetchFonts = async () => {
                    setLoading(true);
                    
                    const cachedData = localStorage.getItem('cached_fonts_data');
                    if (cachedData) {
                        try {
                            const { timestamp, data } = JSON.parse(cachedData);
                            if (Date.now() - timestamp < CACHE_DURATION) {
                                setFonts(data);
                                setRecent(data.slice(0, 10)); // Top 10 recent
                                setLoading(false);
                                return; 
                            }
                        } catch (e) { localStorage.removeItem('cached_fonts_data'); }
                    }

                    try {
                        // Use Raw JSON from GitHub instead of API
                        const jsonUrl = `https://raw.githubusercontent.com/${DEFAULT_OWNER}/${DEFAULT_REPO}/main/fonts.json?t=${Date.now()}`;
                        const res = await fetch(jsonUrl);
                        
                        if (!res.ok) throw new Error("Failed to load fonts list");
                        
                        let all = await res.json();
                        if (!Array.isArray(all)) all = [];

                        // Assuming JSON has fonts, last added are at the end, so reverse for recent
                        const recentFonts = [...all].reverse().slice(0, 10);
                        
                        setFonts(all);
                        setRecent(recentFonts);

                        localStorage.setItem('cached_fonts_data', JSON.stringify({
                            timestamp: Date.now(),
                            data: all,
                            recent: recentFonts
                        }));

                    } catch(e) { 
                        console.error("Fetch Error:", e);
                    } finally { 
                        setLoading(false); 
                    }
                };
                fetchFonts();
            }, []);

            const toggleFavorite = (name) => {
                let newFavs;
                if (favorites.includes(name)) newFavs = favorites.filter(f => f !== name);
                else { newFavs = [...favorites, name]; showToast("Added to Favorites"); }
                setFavorites(newFavs);
                localStorage.setItem('fav_fonts', JSON.stringify(newFavs));
            };

            const toggleCompare = (file) => {
                if (compareList.find(f => f.name === file.name)) {
                    setCompareList(compareList.filter(f => f.name !== file.name));
                } else {
                    if (compareList.length >= 4) { showToast("Max 4 fonts allowed!", "error"); return; }
                    setCompareList([...compareList, file]);
                    showToast("Added to compare");
                }
            };

            const toggleEffect = (effect) => {
                setTextEffects(prev => ({...prev, [effect]: !prev[effect]}));
            };

            // VOICE TYPING FEATURE
            const toggleVoice = () => {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    showToast("Browser does not support Voice!", "error");
                    return;
                }
                
                if (isListening) {
                    setIsListening(false); // Manually stop not fully supported by all simple implementations, but handled by onend
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.lang = 'bn-BD';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    setIsListening(true);
                    showToast("Speaking...", "success");
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setPreview(transcript);
                    setIsListening(false);
                };

                recognition.onerror = (event) => {
                    console.error(event.error);
                    setIsListening(false);
                    showToast("Voice Error", "error");
                };

                recognition.onend = () => {
                    setIsListening(false);
                };

                recognition.start();
            };
            
            // RANDOM FONT FEATURE
            const pickRandomFont = () => {
                if(fonts.length === 0) return;
                const randomIndex = Math.floor(Math.random() * fonts.length);
                const font = fonts[randomIndex];
                setSearch(font.name); // Filter to show only this font
                showToast(`Found: ${font.name}`, "success");
            };

            const filteredAndSorted = useMemo(() => {
                let list = [...fonts];
                if (showFav) list = list.filter(f => favorites.includes(f.name));
                if (search) list = list.filter(f => f.name.toLowerCase().includes(search.toLowerCase()));
                if (sortBy === 'name') {
                    list.sort((a, b) => a.name.localeCompare(b.name));
                } else if (sortBy === 'popular') {
                    list.sort((a, b) => (fontStats[b.name] || 0) - (fontStats[a.name] || 0));
                } 
                return list;
            }, [fonts, search, showFav, favorites, sortBy, fontStats]);

            // Calculate Trending Threshold (Top 10% of downloads or > 50)
            const trendingThreshold = useMemo(() => {
                 if (Object.keys(fontStats).length === 0) return 100;
                 const counts = Object.values(fontStats).sort((a,b) => b-a);
                 const top10Index = Math.floor(counts.length * 0.1);
                 return counts[top10Index] || 50;
            }, [fontStats]);

            const totalPages = Math.ceil(filteredAndSorted.length / ITEMS_PER_PAGE);
            const paginatedFonts = useMemo(() => {
                 return filteredAndSorted.slice((currentPage - 1) * ITEMS_PER_PAGE, currentPage * ITEMS_PER_PAGE);
            }, [filteredAndSorted, currentPage]);

            useEffect(() => { setCurrentPage(1); }, [search, showFav, sortBy]);

            const changePage = (newPage) => {
                if(newPage >= 1 && newPage <= totalPages) {
                    setCurrentPage(newPage);
                    window.scrollTo({ top: 100, behavior: 'smooth' });
                }
            };

            const applyTheme = (theme) => {
                switch(theme) {
                    case 'dark': setPreviewColor('#ffffff'); setPreviewBg('#0f172a'); break;
                    case 'light': setPreviewColor('#000000'); setPreviewBg('#ffffff'); break;
                    case 'blueprint': setPreviewColor('#ffffff'); setPreviewBg('#2563eb'); break;
                    default: setPreviewColor('#ffffff'); setPreviewBg('transparent'); setSize(32); setLetterSpacing(0); setTextEffects({bold:false,italic:false,shadow:false,outline:false});
                }
                showToast("Theme applied!");
            };

            if(!loaded) return <div className="min-h-screen bg-slate-900 flex items-center justify-center text-slate-400">Loading...</div>;
            if(!config.isSiteActive) return <MaintenanceScreen />;

            return (
                <div className="min-h-screen pb-24 flex flex-col relative">
                    <ToastContainer toasts={toasts} />
                    <Navigation onOpenSubmit={() => setSubmitOpen(true)} onOpenTypingTest={() => setShowTypingTest(true)} showFav={showFav} setShowFav={setShowFav} />
                    <SmartNotice config={config.notice} />
                    
                    {/* Modals */}
                    {dlFile && <DownloadModal file={dlFile} onClose={() => setDlFile(null)} showToast={showToast} />}
                    <SubmitFontModal isOpen={submitOpen} onClose={() => setSubmitOpen(false)} existingFonts={fonts} showToast={showToast} />
                    <GlyphModal font={glyphFont} onClose={() => setGlyphFont(null)} showToast={showToast} />
                    <LigatureModal font={ligatureFont} onClose={() => setLigatureFont(null)} />
                    {showCompareModal && <CompareModal fonts={compareList} text={preview} onClose={() => setShowCompareModal(false)} />}
                    {showTypingTest && <TypingTestModal fonts={fonts} onClose={() => setShowTypingTest(false)} />}

                    {/* STICKY HEADER */}
                    <div className="bg-slate-900/95 sticky top-[53px] z-30 border-b border-slate-800 p-4 shadow-lg backdrop-blur">
                        <div className="max-w-7xl mx-auto space-y-3">
                            <div className="flex flex-col md:flex-row gap-4 items-center">
                                <div className="flex-1 w-full relative group flex gap-2">
                                    <div className="relative flex-1">
                                        <Icon name="search" className="absolute left-3 top-2.5 w-5 h-5 text-slate-500 group-focus-within:text-cyan-400 transition" />
                                        <input type="text" placeholder="Search fonts..." className="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-white outline-none focus:border-cyan-500 transition" value={search} onChange={e => setSearch(e.target.value)} />
                                    </div>
                                    <button onClick={pickRandomFont} className="bg-slate-800 border border-slate-700 hover:bg-slate-700 hover:text-cyan-400 text-slate-400 p-2 rounded-lg transition" title="Surprise Me (Random Font)">
                                        <Icon name="dices" className="w-5 h-5" />
                                    </button>
                                </div>
                                <div className="flex-1 w-full relative group">
                                    <Icon name="pen-tool" className="absolute left-3 top-2.5 w-5 h-5 text-slate-500 group-focus-within:text-cyan-400 transition" />
                                    <input type="text" placeholder="Type to preview..." className="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-10 py-2 text-white outline-none focus:border-cyan-500 transition" value={preview} onChange={e => setPreview(e.target.value)} />
                                    <button onClick={toggleVoice} className={`absolute right-2 top-1.5 p-1 rounded-full transition-all ${isListening ? 'mic-listening' : 'text-slate-500 hover:text-white'}`} title="Voice Typing (Bangla)">
                                        <Icon name={isListening ? "mic-off" : "mic"} className="w-5 h-5" />
                                    </button>
                                </div>
                            </div>

                            <div className="flex flex-wrap items-center justify-between gap-3 bg-slate-800/50 p-2 rounded-lg border border-slate-700/50">
                                <div className="flex items-center gap-2 px-2">
                                    <span className="text-xs text-slate-500 font-bold w-6">Size</span>
                                    <input type="range" min="12" max="72" value={size} onChange={e => setSize(Number(e.target.value))} className="w-20 h-1 bg-slate-600 rounded-lg accent-cyan-500" />
                                </div>
                                <div className="flex items-center gap-2 px-2 hidden sm:flex">
                                    <span className="text-xs text-slate-500 font-bold w-6" title="Letter Spacing">Space</span>
                                    <input type="range" min="-2" max="10" step="0.5" value={letterSpacing} onChange={e => setLetterSpacing(Number(e.target.value))} className="w-20 h-1 bg-slate-600 rounded-lg accent-purple-500" />
                                </div>
                                <div className="h-6 w-px bg-slate-700 hidden sm:block"></div>
                                {/* Text Style Controls */}
                                <div className="flex items-center gap-1">
                                    <button onClick={() => toggleEffect('bold')} className={`w-8 h-8 rounded flex items-center justify-center font-bold transition ${textEffects.bold ? 'bg-cyan-600 text-white' : 'bg-slate-700 text-slate-400 hover:text-white'}`} title="Bold">B</button>
                                    <button onClick={() => toggleEffect('italic')} className={`w-8 h-8 rounded flex items-center justify-center italic transition ${textEffects.italic ? 'bg-cyan-600 text-white' : 'bg-slate-700 text-slate-400 hover:text-white'}`} title="Italic">I</button>
                                    <button onClick={() => toggleEffect('shadow')} className={`w-8 h-8 rounded flex items-center justify-center transition ${textEffects.shadow ? 'bg-cyan-600 text-white' : 'bg-slate-700 text-slate-400 hover:text-white'}`} title="Shadow" style={{textShadow: '1px 1px 2px black'}}>S</button>
                                    <button onClick={() => toggleEffect('outline')} className={`w-8 h-8 rounded flex items-center justify-center transition ${textEffects.outline ? 'bg-cyan-600 text-white' : 'bg-slate-700 text-slate-400 hover:text-white'}`} title="Outline" style={{WebkitTextStroke: '1px currentColor', color:'transparent'}}>O</button>
                                </div>

                                <div className="h-6 w-px bg-slate-700 hidden sm:block"></div>
                                <div className="flex items-center gap-1">
                                    <button onClick={() => applyTheme('dark')} className="w-6 h-6 rounded-full bg-slate-900 border border-slate-600 hover:scale-110 transition" title="Dark Theme"></button>
                                    <button onClick={() => applyTheme('light')} className="w-6 h-6 rounded-full bg-white border border-slate-300 hover:scale-110 transition" title="Light Theme"></button>
                                    <button onClick={() => applyTheme('blueprint')} className="w-6 h-6 rounded-full bg-blue-600 border border-blue-400 hover:scale-110 transition" title="Blueprint"></button>
                                    <div className="flex items-center gap-1 ml-2 pl-2 border-l border-slate-700">
                                        <div className="color-picker-wrapper w-6 h-6 border-none bg-transparent">
                                            <Icon name="palette" className="w-4 h-4 text-slate-400 absolute top-1 left-1 pointer-events-none" />
                                            <input type="color" value={previewColor} onChange={(e) => setPreviewColor(e.target.value)} title="Text Color"/>
                                        </div>
                                        <div className="color-picker-wrapper w-6 h-6 border-none bg-transparent">
                                            <Icon name="box" className="w-4 h-4 text-slate-400 absolute top-1 left-1 pointer-events-none" />
                                            <input type="color" value={previewBg} onChange={(e) => setPreviewBg(e.target.value)} title="Background Color"/>
                                        </div>
                                    </div>
                                </div>
                                <div className="h-6 w-px bg-slate-700 hidden sm:block"></div>
                                <div className="flex gap-2 ml-auto">
                                    <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="bg-slate-900 text-xs text-white border border-slate-700 rounded px-2 py-1 outline-none focus:border-cyan-500">
                                        <option value="date">Newest</option>
                                        <option value="popular">Popular</option>
                                        <option value="name">Name (A-Z)</option>
                                    </select>
                                    <div className="flex bg-slate-900 rounded p-1">
                                        <button onClick={() => setViewMode('grid')} className={`p-1.5 rounded transition ${viewMode === 'grid' ? 'bg-cyan-600 text-white' : 'text-slate-400 hover:text-white'}`}><Icon name="grid" className="w-3 h-3" /></button>
                                        <button onClick={() => setViewMode('list')} className={`p-1.5 rounded transition ${viewMode === 'list' ? 'bg-cyan-600 text-white' : 'text-slate-400 hover:text-white'}`}><Icon name="list" className="w-3 h-3" /></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex-grow max-w-7xl mx-auto px-4 py-6 w-full space-y-8">
                        {!showFav && <><NewsTicker fonts={recent} /><PromoBanner /><div className="flex justify-center"><AdsterraIframe w={320} h={50} o={{'key':'16fc4ecb77ab38742ff7846541a24730','format':'iframe','height':50,'width':320,'params':{}}} s="https://www.highperformanceformat.com/16fc4ecb77ab38742ff7846541a24730/invoke.js"/></div></>}

                        {loading ? <div className="text-center text-slate-400 py-10">Loading Fonts...</div> : (
                            <>
                                <section>
                                    <div className="flex items-center justify-between mb-4 pb-2 border-b border-slate-800">
                                        <div className="flex items-center gap-2">
                                            <Icon name={showFav ? "heart" : "layers"} className={`w-5 h-5 ${showFav ? 'text-pink-500' : 'text-slate-400'}`} />
                                            <h2 className="text-lg font-bold text-white">
                                                {showFav ? `Favorites` : sortBy === 'popular' ? 'Most Popular' : sortBy === 'name' ? 'A-Z List' : 'Latest Fonts'} 
                                                <span className="text-slate-500 ml-2 text-sm">({filteredAndSorted.length})</span>
                                            </h2>
                                        </div>
                                        <span className="text-xs text-slate-500">Page {currentPage} of {totalPages}</span>
                                    </div>
                                    
                                    {paginatedFonts.length === 0 ? <div className="text-center py-10 text-slate-500">No fonts found.</div> : (
                                        <div className={viewMode === 'grid' ? "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" : "flex flex-col gap-3"}>
                                            {paginatedFonts.map(f => (
                                                <FontCard 
                                                    key={f.path || f.name} 
                                                    file={f} 
                                                    viewMode={viewMode} 
                                                    previewText={preview} 
                                                    previewFontSize={size} 
                                                    previewColor={previewColor} 
                                                    previewBg={previewBg} 
                                                    letterSpacing={letterSpacing}
                                                    textEffects={textEffects} 
                                                    onDownloadClick={setDlFile} 
                                                    downloadCount={fontStats[f.name]} 
                                                    isFav={favorites.includes(f.name)} 
                                                    onToggleFav={toggleFavorite}
                                                    onOpenGlyph={setGlyphFont}
                                                    onOpenLigature={setLigatureFont}
                                                    onToggleCompare={toggleCompare}
                                                    isCompared={!!compareList.find(c => c.name === f.name)}
                                                    isTrending={(fontStats[f.name] || 0) >= trendingThreshold}
                                                    showToast={showToast}
                                                />
                                            ))}
                                        </div>
                                    )}

                                    {/* PAGINATION */}
                                    {totalPages > 1 && (
                                        <div className="flex justify-center items-center gap-2 mt-10">
                                            <button onClick={() => changePage(currentPage - 1)} disabled={currentPage === 1} className="p-2 rounded bg-slate-800 border border-slate-700 text-slate-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"><Icon name="chevron-left" className="w-5 h-5" /></button>
                                            <div className="flex gap-1">
                                                {Array.from({length: Math.min(5, totalPages)}, (_, i) => {
                                                    let p = i + 1;
                                                    if(totalPages > 5) {
                                                        if (currentPage <= 3) p = i + 1;
                                                        else if (currentPage >= totalPages - 2) p = totalPages - 4 + i;
                                                        else p = currentPage - 2 + i;
                                                    }
                                                    if(p > totalPages || p < 1) return null;
                                                    return (
                                                        <button key={p} onClick={() => changePage(p)} className={`w-8 h-8 rounded text-sm font-bold transition ${currentPage === p ? 'bg-cyan-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>{p}</button>
                                                    );
                                                })}
                                            </div>
                                            <button onClick={() => changePage(currentPage + 1)} disabled={currentPage === totalPages} className="p-2 rounded bg-slate-800 border border-slate-700 text-slate-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"><Icon name="chevron-right" className="w-5 h-5" /></button>
                                        </div>
                                    )}
                                </section>
                            </>
                        )}
                    </div>
                    
                    {/* Floating Compare Bar */}
                    {compareList.length > 0 && (
                        <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-cyan-600 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-4 animate-fade-in">
                            <span className="font-bold flex items-center gap-2"><Icon name="layers" className="w-5 h-5"/> {compareList.length} Selected</span>
                            <div className="h-5 w-px bg-white/30"></div>
                            <button onClick={() => setShowCompareModal(true)} className="hover:underline font-bold">Compare Now</button>
                            <button onClick={() => setCompareList([])} className="bg-white/20 p-1 rounded-full hover:bg-white/30"><Icon name="x" className="w-4 h-4"/></button>
                        </div>
                    )}

                    <footer className="bg-slate-900 border-t border-slate-800 py-6 text-center text-slate-600 text-xs">
                        <div className="flex justify-center gap-4 mb-2"><a href="disclaimer.html" className="hover:text-cyan-400">Disclaimer</a><span>|</span><a href="privacy.html" className="hover:text-cyan-400">Privacy Policy</a></div>
                        <p>&copy; 2024 TVBD.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Home />);
    </script>
      
</body>
</html>